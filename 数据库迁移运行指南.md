# æ•°æ®åº“è¿ç§»è¿è¡ŒæŒ‡å—

## ğŸ“ è¿ç§»è„šæœ¬è¯´æ˜

å·²åˆ›å»ºè¿ç§»æ–‡ä»¶ï¼š[1768600000000-AddContactCSConfig.ts](backend/src/migrations/1768600000000-AddContactCSConfig.ts)

### è¿ç§»å†…å®¹

**Tasks è¡¨æ–°å¢å­—æ®µï¼š**
- `contactCSConfig` (jsonb, nullable) - å­˜å‚¨è”ç³»å®¢æœé…ç½®

**Orders è¡¨æ–°å¢å­—æ®µï¼š**
- `needContactCS` (boolean, default: false) - è¯¥è®¢å•æ˜¯å¦éœ€è¦è”ç³»å®¢æœ
- `contactCSQuestions` (jsonb, nullable) - åˆ†é…ç»™è¯¥è®¢å•çš„é—®é¢˜åˆ—è¡¨

---

## ğŸš€ è¿è¡Œè¿ç§»

### æ–¹å¼1ï¼šä½¿ç”¨ TypeORM CLIï¼ˆæ¨èï¼‰

```bash
cd backend
npm run typeorm migration:run
```

### æ–¹å¼2ï¼šæ‰‹åŠ¨æ‰§è¡Œ SQL

å¦‚æœ TypeORM å‘½ä»¤ä¸å¯ç”¨ï¼Œå¯ä»¥ç›´æ¥åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œï¼š

```sql
-- æ·»åŠ  Tasks è¡¨å­—æ®µ
ALTER TABLE tasks ADD COLUMN IF NOT EXISTS "contactCSConfig" jsonb;

-- æ·»åŠ  Orders è¡¨å­—æ®µ
ALTER TABLE orders ADD COLUMN IF NOT EXISTS "needContactCS" boolean NOT NULL DEFAULT false;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS "contactCSQuestions" jsonb;
```

---

## âœ… éªŒè¯è¿ç§»

### 1. æ£€æŸ¥å­—æ®µæ˜¯å¦åˆ›å»ºæˆåŠŸ

```sql
-- æ£€æŸ¥ tasks è¡¨
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'tasks' AND column_name = 'contactCSConfig';

-- æ£€æŸ¥ orders è¡¨
SELECT column_name, data_type, is_nullable, column_default
FROM information_schema.columns
WHERE table_name = 'orders' AND column_name IN ('needContactCS', 'contactCSQuestions');
```

### 2. é¢„æœŸç»“æœ

**tasks è¡¨ï¼š**
- contactCSConfig | jsonb | YES

**orders è¡¨ï¼š**
- needContactCS | boolean | NO | false
- contactCSQuestions | jsonb | YES

---

## ğŸ”„ å›æ»šè¿ç§»ï¼ˆå¦‚éœ€è¦ï¼‰

å¦‚æœéœ€è¦å›æ»šè¿ç§»ï¼š

```bash
cd backend
npm run typeorm migration:revert
```

æˆ–æ‰‹åŠ¨æ‰§è¡Œï¼š

```sql
ALTER TABLE tasks DROP COLUMN IF EXISTS "contactCSConfig";
ALTER TABLE orders DROP COLUMN IF EXISTS "needContactCS";
ALTER TABLE orders DROP COLUMN IF EXISTS "contactCSQuestions";
```

---

## ğŸ“‹ è¿ç§»åæ­¥éª¤

1. âœ… è¿è¡Œè¿ç§»è„šæœ¬
2. âœ… éªŒè¯å­—æ®µåˆ›å»ºæˆåŠŸ
3. âœ… é‡å¯åç«¯æœåŠ¡
4. âœ… æµ‹è¯•æ–°åŠŸèƒ½

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šTypeORM å‘½ä»¤æ‰¾ä¸åˆ°

**è§£å†³æ–¹æ¡ˆï¼š** ä½¿ç”¨æ–¹å¼2æ‰‹åŠ¨æ‰§è¡Œ SQL

### é—®é¢˜2ï¼šå­—æ®µå·²å­˜åœ¨é”™è¯¯

**åŸå› ï¼š** å¯èƒ½å·²ç»è¿è¡Œè¿‡è¿ç§»æˆ–ä½¿ç”¨äº† `synchronize: true`

**è§£å†³æ–¹æ¡ˆï¼š** æ£€æŸ¥æ•°æ®åº“ï¼Œå¦‚æœå­—æ®µå·²å­˜åœ¨åˆ™è·³è¿‡è¿ç§»

### é—®é¢˜3ï¼šæƒé™ä¸è¶³

**è§£å†³æ–¹æ¡ˆï¼š** ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰ ALTER TABLE æƒé™

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
2. æ•°æ®åº“ç”¨æˆ·æƒé™æ˜¯å¦è¶³å¤Ÿ
3. è¡¨åæ˜¯å¦æ­£ç¡®ï¼ˆtasks, ordersï¼‰
4. åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
