# 商户中心功能对等性深度审计报告

**审计日期**: 2026-01-12  
**审计类型**: 字段级功能对等性分析  
**审计方法**: 逐行代码对比 (HTML/Vue.js ↔ TSX/React)

---

## 执行摘要

本审计从**字段级别**对比原版ThinkPHP系统与重构版Next.js系统的功能差异。

**关键发现**: 任务发布模块存在**严重的功能缺失**，尤其是在第一步的关键词高级设置和商品配置方面。

| 统计项 | 数量 |
|--------|------|
| 🔴 P0级缺失 (阻断业务) | **15项** |
| 🟡 P1级问题 (功能受限) | 6项 |
| ✅ 已对齐功能 | 18项 |
| ✨ 新增增强功能 | 13项 |

**结论**: 重构版**不满足上线条件**，需补全P0级缺失功能。

---

## 一、任务发布第一步：字段级对比

**原版文件**: `dispatch.html` (722行)  
**重构版文件**: `Step1BasicInfo.tsx` (618行)

### 1.1 任务基础信息

| 功能字段 | 原版位置 | 原版字段名 | 重构版位置 | 重构版字段名 | 状态 |
|---------|---------|-----------|-----------|-------------|------|
| 选择店铺 | L86-91 | `datainfo.shop_id` | L270-279 | `data.shopId` | ✅ 对齐 |
| 任务类型 | L94-124 | `datainfo.task_type` (1-5) | L243-267 | `data.taskEntryType` (KEYWORD/TAOWORD/QRCODE/ZTC/CHANNEL) | ✅ 对齐 |
| **返款方式** | L126-134 | `datainfo.terminal` (1=本佣货返, 2=本立佣货) | - | - | 🔴 **完全缺失** |

### 1.2 商品信息配置

| 功能字段 | 原版位置 | 原版字段名 | 重构版位置 | 重构版字段名 | 状态 |
|---------|---------|-----------|-----------|-------------|------|
| 从商品库选择 | L137 | `selectGoods()` | L286-294 | `showGoodsLibModal` | ✅ 对齐 |
| 新建商品 | L140-142 | `goodsAdd()` | L295-302 | `handleAddGoods()` | ✅ 对齐 |
| 最多3个商品限制 | L144-145 | 前端限制3个 | L167 | 无限制 | 🟡 差异 |
| 商品图片显示 | L179 | `item.pc_img` | L317-323 | `goods.image` | ✅ 对齐 |
| 商品名称 | L180 | `item.name` | L329 | `goods.name` | ✅ 对齐 |
| **下单价格(可编辑)** | L182-185 | `item.price` (el-input可编辑) | L332 | 只显示不可编辑 | 🔴 **功能缺失** |
| **下单数量(可编辑)** | L187-188 | `item.num` (el-input可编辑) | L333 | 只显示不可编辑 | 🔴 **功能缺失** |
| 搜索价格显示 | L189 | `item.show_price` | - | - | 🟡 缺失 |
| **详情问答提示** | L203-206 | `item.goods_spec` (**必填**) | - | - | 🔴 **完全缺失** |
| 商品删除 | L169-171 | `goodsDel(index)` | L348-353 | `handleDeleteGoods(id)` | ✅ 对齐 |
| 商品编辑 | L192-196 | `goodsEdit(item.id)` | L342-347 | `handleEditGoods(goods)` | ✅ 对齐 |

### 1.3 关键词配置 (⚠️ 严重差异)

| 功能字段 | 原版位置 | 原版字段名 | 重构版位置 | 重构版字段名 | 状态 |
|---------|---------|-----------|-----------|-------------|------|
| 关键词搜索词 | L222-223 | `row.key_word` | L537 | `goods.keyword` | ⚠️ 部分对齐 |
| **多关键词支持** | L220-234 | 每商品最多**5组**关键词 (`item.key_word[]`数组) | L532-543 | 每商品只有**1个**关键词 | 🔴 **严重缺失** |
| 添加关键词按钮 | L231-234 | `keyAdd(index)` | - | - | 🔴 **缺失** |
| 删除关键词按钮 | L227-229 | `keyRemove(index,key)` | - | - | 🔴 **缺失** |
| **关键词高级设置弹窗** | L224-226, L290-337 | `advanced(index,row,key)` | - | - | 🔴 **完全缺失** |

### 1.4 关键词高级设置详情 (🔴 全部缺失)

原版关键词高级设置对话框 (L290-337) 包含以下字段：

| 高级设置项 | 原版位置 | 原版字段名 | 重构版状态 |
|-----------|---------|-----------|-----------|
| **折扣服务多选** | L293-298 | `advanceds.discount[]` | 🔴 **完全缺失** |
| **商品规格1** | L303-304 | `advanceds.filter.class1` | 🔴 **完全缺失** |
| **商品规格2** | L305-306 | `advanceds.filter.class2` | 🔴 **完全缺失** |
| **货比关键词** | L308-309 | `advanceds.filter.class3` (**必填**) | 🔴 **完全缺失** |
| **备选关键词** | L310-311 | `advanceds.filter.class4` | 🔴 **完全缺失** |
| **排序方式** | L316-320 | `advanceds.sort` | 🔴 **完全缺失** |
| **最低价格** | L322-323 | `advanceds.min_price` | 🔴 **完全缺失** |
| **最高价格** | L325-326 | `advanceds.max_price` | 🔴 **完全缺失** |
| **发货地省份** | L327-330 | `advanceds.province` | 🔴 **完全缺失** |

#### 折扣服务选项列表 (原版 L469-482)

```javascript
discount: {
    0: '包邮',
    1: '公益宝贝',
    2: '全球购',
    3: '消费者保障',
    4: '货到付款',
    5: '淘金币抵钱',
    6: '天猫',
    7: '花呗分期',
    8: '7+天退货',
    9: '天猫超市',
    10: '天猫直送',
    11: '通用排序',
}
```

#### 排序方式选项列表 (原版 L483-489)

```javascript
options: {
    0: '综合排序',
    1: '销量优先',
    2: '价格由高到低',
    3: '价格由低到高',
    4: '信用排序'
}
```

### 1.5 其他入口类型

| 功能字段 | 原版位置 | 原版字段名 | 重构版位置 | 重构版字段名 | 状态 |
|---------|---------|-----------|-----------|-------------|------|
| 淘口令输入 | L239-248 | `datainfo.tao_word` (textarea, 100字) | L375-381 | `data.taoWord` | ✅ 对齐 |
| 二维码上传 | L250-261 | `datainfo.qr_code` (base64图片上传) | L384-401 | `data.qrCodeImage` (URL输入) | 🟡 实现差异 |
| 通道图片上传 | L262-280 | `datainfo.channel_img` (图片上传) | L413-419 | `data.channelUrl` (URL输入) | 🟡 实现差异 |

---

## 二、任务发布第二步：字段级对比

**原版文件**: `task_tow.html` (582行)  
**重构版文件**: `Step2ValueAdded.tsx` (342行)

### 2.1 任务设置

| 功能字段 | 原版位置 | 原版字段名 | 重构版位置 | 重构版字段名 | 状态 |
|---------|---------|-----------|-----------|-------------|------|
| 返款方式显示 | L89-91 | `datainfo.terminal` (本佣货返/本立佣货) | - | - | 🔴 **缺失** (第一步未传递) |
| 任务单数设置 | L115-116 | `datainfo.num` (max=10, min=0) | L423-434 (Step1) | `data.count` | ✅ 对齐 |
| **关键词使用次数** | L104 | `val.num` (每个关键词独立设置使用次数) | - | - | 🔴 **完全缺失** |

### 2.2 下单提示

| 功能字段 | 原版位置 | 原版字段名 | 重构版位置 | 重构版字段名 | 状态 |
|---------|---------|-----------|-----------|-------------|------|
| **下单提示/备注** | L129-135 | `datainfo.memo` (textarea, 100字, 非必填) | - | - | 🔴 **完全缺失** |

> 原版说明: "买手接任务时可看见该提示，提示内容自由填写，如：商品在第*页*行、聊天时不要问发货地和哪家快递等"

### 2.3 增值服务对比

| 功能字段 | 原版位置 | 原版字段名 | 重构版位置 | 重构版字段名 | 状态 |
|---------|---------|-----------|-----------|-------------|------|
| 是否包邮 | L144-152 | `datainfo.is_free_shiping` (1=包邮, 2=不包邮) | L75-78 | `data.isFreeShipping` | ✅ 对齐 |
| 不包邮额外说明 | L150 | "每单额外支出10元作为运费押金" | - | 无不包邮选项 | 🟡 差异 |
| **包裹重量** | L154-167 | `datainfo.weight` (0-30kg, 可设小数点后两位) | - | - | 🔴 **完全缺失** |
| **快速返款服务** | L169-185 | 服务费0.6%，有tooltip帮助说明 | - | - | 🔴 **完全缺失** |
| 加赏任务礼金 | L187-199 | `datainfo.add_reward` (min=0, 显示总计) | L294-301 | `data.addReward` | ✅ 对齐 |
| 定时付款 | L201-216 | `datainfo.is_timing_pay` + `datainfo.timing_time` | L302-309 | `data.isTimingPay` + `data.timingPayTime` | ✅ 对齐 |
| 隔天任务 | L218-232 | `datainfo.next_day` | L325-331 | `data.isNextDay` | ✅ 对齐 |
| **回购任务** | L234-243 | `datainfo.is_repay` ("只有老顾客才能接的任务") | L318-324 | `data.isRepay` | ✅ **已修复** |
| 定时发布 | L244-254 | `datainfo.is_timing_publish` + `datainfo.publish_time` | L286-293 | `data.isTimingPublish` + `data.publishTime` | ✅ 对齐 |
| **任务接单间隔** | L256-268 | `datainfo.union_interval_time` (分钟) | - | - | 🔴 **完全缺失** |
| 延长买家购物周期 | L270-293 | `datainfo.is_cycle_time` + `datainfo.cycle_time` (30/60/90天) | L310-317 | `data.isCycleTime` + `data.cycleTime` | ✅ 对齐 |

### 2.4 好评设置对比

| 功能字段 | 原版位置 | 原版字段名 | 重构版位置 | 重构版字段名 | 状态 |
|---------|---------|-----------|-----------|-------------|------|
| 设置优质好评 | L294-313 | `datainfo.is_praise` + `datainfo.praise[]` | L166-192 | `data.isPraise` + `data.praiseList` | ✅ 对齐 |
| 默认好评提示 | L300 | "如未设置将默认15字与产品相关的文字好评" | L66 | `praiseType='none'` 默认好评 | ✅ 对齐 |
| 上传图片好评 | L314-341 | `datainfo.is_img_praise` + `datainfo.img[]` | L194-217 | `data.praiseImgList` | ✅ 对齐 |
| 图片数量限制 | L556 | 最多5张/单 | L41 | 最多5张/单 | ✅ 对齐 |
| 图片任务单数限制 | L518-521 | 图片任务一次仅能发布5单 | - | 无限制 | 🟡 差异 |
| 上传视频好评 | L343-363 | `datainfo.is_video_praise` + `datainfo.video` | L219-264 | `data.praiseVideoList` | ✅ 对齐 |
| 视频任务限制 | L540-547 | 有且仅能发1单，且只能单一商品 | - | 无限制 | 🟡 差异 |

---

## 三、重构版新增功能 (原版没有)

### 3.1 浏览行为设置 (Step2 L80-135)

| 新增功能 | 字段名 | 说明 |
|---------|--------|------|
| ✨ 货比设置 | `needCompare` + `compareCount` | 买手需先浏览其他商品 (2/3/5家) |
| ✨ 收藏商品 | `needFavorite` | 买手需收藏商品 |
| ✨ 关注店铺 | `needFollow` | 买手需关注店铺 |
| ✨ 加入购物车 | `needAddCart` | 买手需先加入购物车 |
| ✨ 联系客服 | `needContactCS` + `contactCSContent` | 买手需与客服沟通 |

### 3.2 浏览时长设置 (Step2 L137-164)

| 新增功能 | 字段名 | 说明 |
|---------|--------|------|
| ✨ 总浏览时长 | `totalBrowseMinutes` | 5-60分钟 |
| ✨ 主商品浏览时长 | `mainBrowseMinutes` | 3-30分钟 |
| ✨ 副商品浏览时长 | `subBrowseMinutes` | 1-10分钟 |

### 3.3 口令验证 (Step2 L270-285)

| 新增功能 | 字段名 | 说明 |
|---------|--------|------|
| ✨ 开启口令验证 | `isPasswordEnabled` | 买手需在详情页找到口令 |
| ✨ 核对口令内容 | `checkPassword` | 4-10个字符 |

---

## 四、P0级缺失功能完整列表

### 第一步 (Step1BasicInfo.tsx)

| # | 缺失功能 | 原版位置 | 原版字段 | 业务影响 | 修复工作量 |
|---|---------|---------|---------|---------|-----------|
| 1 | **返款方式选择** | L126-134 | `terminal` | 无法区分本立佣货/本佣货返 | 2小时 |
| 2 | **商品下单价格可编辑** | L182-185 | `item.price` (input) | 无法修改下单价格 | 1小时 |
| 3 | **商品下单数量可编辑** | L187-188 | `item.num` (input) | 无法修改购买数量 | 1小时 |
| 4 | **详情问答提示** | L203-206 | `item.goods_spec` | 买手无法获取商品详情线索 | 2小时 |
| 5 | **多关键词支持** | L220-234 | `item.key_word[]` (数组) | 无法添加多组关键词 | 4小时 |
| 6 | **关键词高级设置-折扣服务** | L293-298 | `advanceds.discount[]` | 无法筛选折扣商品 | 3小时 |
| 7 | **关键词高级设置-商品规格** | L303-306 | `advanceds.filter.class1/class2` | 无法指定规格搜索 | 2小时 |
| 8 | **关键词高级设置-货比关键词** | L308-309 | `advanceds.filter.class3` | **必填字段**缺失 | 2小时 |
| 9 | **关键词高级设置-排序方式** | L316-320 | `advanceds.sort` | 无法指定搜索排序 | 1小时 |
| 10 | **关键词高级设置-价格范围** | L321-326 | `advanceds.min_price/max_price` | 无法限定价格筛选 | 1小时 |
| 11 | **关键词高级设置-发货地** | L327-330 | `advanceds.province` | 无法指定发货地筛选 | 1小时 |

### 第二步 (Step2ValueAdded.tsx)

| # | 缺失功能 | 原版位置 | 原版字段 | 业务影响 | 修复工作量 |
|---|---------|---------|---------|---------|-----------|
| 12 | **关键词使用次数** | L104 | `val.num` | 无法控制每个关键词的使用次数 | 2小时 |
| 13 | **下单提示/备注** | L129-135 | `datainfo.memo` | 商户无法给买手提示 | 1小时 |
| 14 | **包裹重量设置** | L154-167 | `datainfo.weight` | 物流费用计算不准确 | 2小时 |
| 15 | **快速返款服务** | L169-185 | 0.6%服务费 | 缺少增值服务收入 | 2小时 |
| 16 | **任务接单间隔** | L256-268 | `datainfo.union_interval_time` | 无法控制接单节奏 | 2小时 |

**总计修复工作量**: 约 **29小时** (约4个工作日)

---

## 五、P1级问题列表

| # | 问题 | 说明 | 工作量 |
|---|------|------|--------|
| 1 | 商品数量限制缺失 | 原版限制最多3个商品 | 0.5小时 |
| 2 | 搜索价格显示缺失 | 原版显示 `item.show_price` | 0.5小时 |
| 3 | 二维码/通道图片上传方式 | 原版用图片上传，重构版用URL输入 | 2小时 |
| 4 | 图片任务单数限制 | 原版限制图片任务一次最多5单 | 1小时 |
| 5 | 视频任务限制 | 原版限制有且仅能发1单且单一商品 | 1小时 |
| 6 | 不包邮选项缺失 | 原版支持不包邮 (额外10元运费押金) | 2小时 |

---

## 六、修复优先级建议

### Phase 1 - 阻断性问题 (必须修复) - 预计3天

1. **添加返款方式选择** (terminal)
2. **添加详情问答提示字段** (goods_spec) - **必填**
3. **商品价格/数量可编辑**
4. **多关键词支持** (每商品最多5组)
5. **关键词高级设置弹窗** (含所有子字段)
6. **关键词使用次数设置**
7. **下单提示/备注字段**

### Phase 2 - 功能完整性 (建议修复) - 预计2天

8. 包裹重量设置
9. 快速返款服务
10. 任务接单间隔
11. 商品数量限制 (最多3个)
12. 图片/视频任务限制

### Phase 3 - 体验优化 (可选) - 预计1天

13. 二维码/通道图片上传方式
14. 搜索价格显示
15. 不包邮选项

---

## 七、技术实现建议

### 7.1 多关键词数据结构

```typescript
// GoodsItem 扩展
interface GoodsItem {
    // ... 现有字段
    keywords: KeywordConfig[];  // 改为数组，最多5组
}

interface KeywordConfig {
    keyword: string;           // 搜索关键词
    useCount?: number;         // 使用次数
    advancedSettings?: {
        discount: string[];    // 折扣服务选项 (12项多选)
        spec1: string;         // 规格1
        spec2: string;         // 规格2
        compareKeyword: string; // 货比关键词 (必填)
        backupKeyword: string;  // 备选关键词
        sort: string;          // 排序方式
        minPrice: number;      // 最低价
        maxPrice: number;      // 最高价
        province: string;      // 发货地
    };
}
```

### 7.2 TaskFormData 扩展

```typescript
interface TaskFormData {
    // ... 现有字段
    terminal: 1 | 2;           // 返款方式: 1=本佣货返, 2=本立佣货
    memo: string;              // 下单提示/备注 (最多100字)
    weight: number;            // 包裹重量 (0-30kg)
    fastReturn: boolean;       // 快速返款服务 (0.6%费率)
    unionIntervalTime: number; // 任务接单间隔 (分钟)
}
```

---

## 八、最终结论

### 当前状态评估

| 指标 | 状态 |
|------|------|
| 功能对齐度 | **~65%** (第一步关键词配置严重缺失) |
| 可上线状态 | 🔴 **不满足上线条件** |
| 主要阻断项 | 关键词高级设置、多关键词支持、详情问答提示 |

### 上线前必须完成

1. ✅ 补全第一步所有P0缺失功能 (11项)
2. ✅ 补全第二步所有P0缺失功能 (5项)
3. ✅ 进行完整的端到端测试

### 修复后预期

| 指标 | 修复后 |
|------|--------|
| 功能对齐度 | **~95%** |
| 可上线状态 | ✅ 满足上线条件 |
| 功能增强项 | +13项 (浏览行为、浏览时长、口令验证等) |

---

**报告生成时间**: 2026-01-12 (深度审计版)  
**审计方法**: 逐行代码对比  
**对比文件**: 
- 原版第一步: `dispatch.html` (722行)
- 原版第二步: `task_tow.html` (582行)
- 重构版第一步: `Step1BasicInfo.tsx` (618行)
- 重构版第二步: `Step2ValueAdded.tsx` (342行)
