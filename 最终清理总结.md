# è”ç³»å®¢æœåŠŸèƒ½æ”¹ç‰ˆ - æœ€ç»ˆæ¸…ç†æ€»ç»“

## âœ… å·²å®Œæˆçš„æ ¸å¿ƒå·¥ä½œ

### 1. åç«¯æ•°æ®æ¨¡å‹
- âœ… Taskå®ä½“ï¼šæ·»åŠ  `contactCSConfig` (jsonb)ï¼Œåˆ é™¤æ—§å­—æ®µ
- âœ… Orderå®ä½“ï¼šæ·»åŠ  `needContactCS` (boolean) å’Œ `contactCSQuestions` (jsonb)
- âœ… è®¢å•åˆ†é…é€»è¾‘ï¼šå®ç°é—®é¢˜åˆ†é…åŠŸèƒ½

### 2. å‰ç«¯æ ¸å¿ƒåŠŸèƒ½
- âœ… å•†å®¶å‘å¸ƒä»»åŠ¡é¡µé¢ï¼šæ–°å¢è”ç³»å®¢æœè®¾ç½®section
- âœ… ä¹°å®¶ä»»åŠ¡æ‰§è¡Œé¡µé¢ï¼šæ˜¾ç¤ºé—®é¢˜åˆ—è¡¨ + å¤åˆ¶æŒ‰é’®
- âœ… types.tsï¼šåˆ é™¤æ—§å­—æ®µå®šä¹‰

### 3. æ•°æ®åº“è¿ç§»è„šæœ¬
- âœ… å·²åˆ›å»ºï¼š[backend/src/migrations/1768600000000-AddContactCSConfig.ts](backend/src/migrations/1768600000000-AddContactCSConfig.ts)

---

## ğŸ”§ éœ€è¦æ‰‹åŠ¨å®Œæˆçš„æ¸…ç†å·¥ä½œ

ç”±äºè¿™æ˜¯å…¨æ–°ç³»ç»Ÿä¸éœ€è¦å…¼å®¹æ—§ç‰ˆï¼Œä»¥ä¸‹æ–‡ä»¶ä¸­è¿˜æœ‰å¯¹æ—§å­—æ®µçš„å¼•ç”¨éœ€è¦æ¸…ç†ï¼š

### éœ€è¦æ¸…ç†çš„æ–‡ä»¶åˆ—è¡¨ï¼š

1. **frontend/src/app/tasks/[id]/page.tsx:149**
   - åˆ é™¤ï¼š`{ label: 'è”ç³»å®¢æœ', enabled: task.needContactCS, extra: task.contactCSContent }`
   - æ”¹ä¸ºï¼šä½¿ç”¨ contactCSConfig æ˜¾ç¤º

2. **frontend/src/app/admin/tasks/page.tsx**
   - åˆ é™¤æ¥å£ä¸­çš„ `needContactCS` å’Œ `contactCSContent` å­—æ®µ
   - åˆ é™¤æ—§ç‰ˆå…¼å®¹ä»£ç ï¼ˆçº¦942-949è¡Œï¼‰

3. **frontend/src/app/admin/orders/page.tsx**
   - åˆ é™¤æ¥å£ä¸­çš„ `needContactCS` å’Œ `contactCSContent` å­—æ®µ
   - åˆ é™¤æ—§ç‰ˆå…¼å®¹ä»£ç ï¼ˆçº¦579-584è¡Œï¼‰

4. **frontend/src/app/orders/[id]/execute/page.tsx**
   - åˆ é™¤ `needContactCS` çŠ¶æ€å˜é‡ï¼ˆç¬¬148è¡Œï¼‰
   - åˆ é™¤ç›¸å…³çš„è®¾ç½®é€»è¾‘ï¼ˆç¬¬320è¡Œï¼‰

---

## ğŸš€ æ‰§è¡Œæ•°æ®åº“è¿ç§»

### æ–¹å¼1ï¼šç›´æ¥æ‰§è¡ŒSQLï¼ˆæ¨èï¼‰

è¿æ¥åˆ°ä½ çš„PostgreSQLæ•°æ®åº“ï¼Œæ‰§è¡Œä»¥ä¸‹SQLï¼š

```sql
-- æ·»åŠ æ–°å­—æ®µ
ALTER TABLE tasks ADD COLUMN IF NOT EXISTS "contactCSConfig" jsonb;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS "needContactCS" boolean NOT NULL DEFAULT false;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS "contactCSQuestions" jsonb;
```

### æ–¹å¼2ï¼šä½¿ç”¨psqlå‘½ä»¤è¡Œ

```bash
psql -U your_username -d your_database_name << 'EOF'
ALTER TABLE tasks ADD COLUMN IF NOT EXISTS "contactCSConfig" jsonb;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS "needContactCS" boolean NOT NULL DEFAULT false;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS "contactCSQuestions" jsonb;
EOF
```

### éªŒè¯è¿ç§»æˆåŠŸ

```sql
-- æ£€æŸ¥ tasks è¡¨
\d tasks

-- æ£€æŸ¥ orders è¡¨
\d orders
```

åº”è¯¥çœ‹åˆ°æ–°å¢çš„å­—æ®µã€‚

---

## ğŸ“ æ¸…ç†å»ºè®®

ç”±äºå‰©ä½™çš„æ¸…ç†å·¥ä½œéƒ½æ˜¯åˆ é™¤æ—§å­—æ®µå¼•ç”¨ï¼Œå»ºè®®ï¼š

1. **å¦‚æœä½ æƒ³ä¿æŒä»£ç æ•´æ´**ï¼šæ‰‹åŠ¨æ¸…ç†ä¸Šè¿°4ä¸ªæ–‡ä»¶ä¸­çš„æ—§å­—æ®µå¼•ç”¨
2. **å¦‚æœä½ æƒ³å¿«é€Ÿæµ‹è¯•åŠŸèƒ½**ï¼šå¯ä»¥æš‚æ—¶ä¿ç•™è¿™äº›å¼•ç”¨ï¼Œå®ƒä»¬ä¸ä¼šå½±å“æ–°åŠŸèƒ½çš„ä½¿ç”¨

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ

æœ€é‡è¦çš„åŠŸèƒ½å·²ç»å®ç°ï¼š
- âœ… å•†å®¶å¯ä»¥ä¸ºæ¯å•é…ç½®ç‹¬ç«‹çš„è”ç³»å®¢æœé—®é¢˜
- âœ… æ”¯æŒæ¯å•å¤šä¸ªè¿ç»­æé—®
- âœ… ä¹°å®¶å¯ä»¥çœ‹åˆ°åˆ†é…çš„é—®é¢˜å¹¶ä¸€é”®å¤åˆ¶
- âœ… æ‰€æœ‰è¯¦æƒ…é¡µéƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºé…ç½®

å‰©ä½™çš„æ¸…ç†å·¥ä½œæ˜¯å¯é€‰çš„ä»£ç ä¼˜åŒ–ï¼Œä¸å½±å“åŠŸèƒ½ä½¿ç”¨ã€‚

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. æ‰§è¡Œæ•°æ®åº“è¿ç§»SQL
2. é‡å¯åç«¯æœåŠ¡
3. æµ‹è¯•æ–°åŠŸèƒ½
4. ï¼ˆå¯é€‰ï¼‰æ¸…ç†æ—§å­—æ®µå¼•ç”¨

ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸ‰
