# seller_cash 业务事实契约 (Business Contract)

> **版本**: v1.0
> **冻结日期**: 2026-01-04
> **数据来源**: 原版数据库 `tfkz_seller_cash` 表
> **约束级别**: LOCKED - 任何修改必须先更新此文档

---

## 表说明

商家提现表，存储商家押金提现申请记录。

---

## 字段契约

| 字段名 | 类型 | 必填 | 历史字段 | 业务语义 | 可修改端 | 备注 |
|--------|------|------|----------|----------|----------|------|
| `id` | int(11) | ✅ | ❌ | 主键ID | 系统 | 自增 |
| `uid` | int(11) | ✅ | ❌ | 商家ID | 系统 | 关联 seller.id |
| `price` | decimal(12,2) | ✅ | ❌ | 提现金额 | 商家 | 申请提现金额 |
| `bank_name` | varchar(50) | ✅ | ❌ | 银行名称 | 商家 | 如：建设银行 |
| `bank_number` | varchar(50) | ✅ | ❌ | 银行卡号 | 商家 | |
| `bank_seller` | varchar(50) | ✅ | ❌ | 开户名 | 商家 | 持卡人姓名 |
| `mobile` | bigint(11) | ✅ | ❌ | 预留手机号 | 商家 | 银行预留手机 |
| `yprice` | decimal(12,2) | ✅ | ❌ | 账户余额 | 系统 | 申请时账户余额快照 |
| `poundage` | decimal(12,2) | ✅ | ❌ | 手续费 | 系统 | 提现手续费 |
| `toaccount` | decimal(12,2) | ✅ | ❌ | 到账金额 | 系统 | = price - poundage |
| `state` | tinyint(11) | ✅ | ❌ | **提现状态** | 后台 | 见状态机定义 |
| `memo` | text | ❌ | ❌ | 备注/拒绝原因 | 后台 | 审核备注或打款单号 |
| `create_time` | int(11) | ✅ | ❌ | 申请时间 | 系统 | 时间戳 |
| `examine_time` | int(11) | ✅ | ❌ | 审核时间 | 后台 | 时间戳 |
| `type` | int(11) | ✅ | ❌ | 提现类型 | 系统 | 1=押金提现 |
| `user_type` | int(11) | ✅ | ❌ | 用户类型 | 系统 | 1=商家 |

---

## 状态机定义 (state)

```
0 (已申请) ────────────────────────────────────────────────────────────┐
     │                                                                  │
     ├──▶ [后台同意] ──▶ 1 (已同意) ──▶ [后台打款] ──▶ 3 (已返款)        │
     │                                                                  │
     └──▶ [后台拒绝] ──▶ 2 (已拒绝) ──▶ [退回金额到账户]                 │
```

| 状态值 | 状态名 | 业务含义 | 允许的前置状态 | 触发角色 |
|--------|--------|----------|---------------|----------|
| 0 | 已申请 | 商家提交提现申请 | (初始) | 商家 |
| 1 | 已同意 | 后台审核通过 | 0 | 后台 |
| 2 | 已拒绝 | 后台审核拒绝 | 0 | 后台 |
| 3 | 已返款 | 已完成打款 | 1 | 后台 |

---

## 关联表

- `seller`: 商家表 (uid)
- `seller_deposit_recharge`: 商家押金财务流水表

---

## 后台可修改字段

以下字段后台管理员有权限修改：

1. `state` - 审核状态 (0→1/2, 1→3)
2. `memo` - 备注/拒绝原因/打款单号
3. `examine_time` - 审核时间

---

## 金额计算规则

- `price` = 商家申请提现金额
- `poundage` = 手续费（根据系统配置计算）
- `toaccount` = price - poundage（实际到账金额）
- `yprice` = 申请时账户余额（用于记录快照）

---

## 业务规则

1. 商家只能提现押金账户余额
2. 提现申请需填写完整银行信息
3. 后台拒绝时需填写拒绝原因，金额退回账户
4. 打款成功后需在 memo 中记录打款单号
