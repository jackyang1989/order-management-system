# user_cash 业务事实契约 (Business Contract)

> **版本**: v1.0
> **冻结日期**: 2026-01-04
> **数据来源**: 原版数据库 `tfkz_user_cash` 表
> **约束级别**: LOCKED - 任何修改必须先更新此文档

---

## 表说明

买手提现表，存储买手余额/银锭提现申请记录。

---

## 字段契约

| 字段名 | 类型 | 必填 | 历史字段 | 业务语义 | 可修改端 | 备注 |
|--------|------|------|----------|----------|----------|------|
| `id` | int(11) | ✅ | ❌ | 主键ID | 系统 | 自增 |
| `uid` | int(11) | ✅ | ❌ | 买手ID | 系统 | 关联 users.id |
| `price` | decimal(12,2) | ✅ | ❌ | 提现金额 | 买手 | 申请提现金额 |
| `type` | int(11) | ✅ | ❌ | **提现类型** | 买手 | 1=余额 2=银锭 |
| `yprice` | decimal(12,2) | ✅ | ❌ | 账户余额 | 系统 | 申请时账户余额快照 |
| `state` | int(11) | ✅ | ❌ | **提现状态** | 后台 | 见状态机定义 |
| `memo` | text | ❌ | ❌ | 备注/拒绝原因 | 后台 | 审核备注或打款单号 |
| `create_time` | int(11) | ✅ | ❌ | 申请时间 | 系统 | 时间戳 |
| `examine_time` | int(11) | ✅ | ❌ | 审核时间 | 后台 | 时间戳 |
| `poundage` | decimal(12,2) | ✅ | ❌ | 手续费 | 系统 | 提现手续费 |
| `toaccount` | decimal(12,2) | ✅ | ❌ | 到账金额 | 系统 | = price - poundage |
| `bank_seller` | varchar(50) | ✅ | ❌ | 开户人 | 买手 | 持卡人姓名 |
| `mobile` | bigint(11) | ✅ | ❌ | 手机号 | 买手 | 银行预留手机 |
| `bank_number` | varchar(30) | ✅ | ❌ | 银行卡号 | 买手 | |
| `bank_name` | varchar(300) | ✅ | ❌ | 银行名称 | 买手 | 如：建设银行 |
| `user_type` | int(11) | ✅ | ❌ | 用户类型 | 系统 | 2=买手 |

---

## 状态机定义 (state)

```
0 (已申请) ────────────────────────────────────────────────────────────┐
     │                                                                  │
     ├──▶ [后台同意] ──▶ 1 (已同意) ──▶ [后台打款] ──▶ 3 (已返款)        │
     │                                                                  │
     └──▶ [后台拒绝] ──▶ 2 (已拒绝) ──▶ [退回金额到账户]                 │
```

| 状态值 | 状态名 | 业务含义 | 允许的前置状态 | 触发角色 |
|--------|--------|----------|---------------|----------|
| 0 | 已申请 | 买手提交提现申请 | (初始) | 买手 |
| 1 | 已同意 | 后台审核通过 | 0 | 后台 |
| 2 | 已拒绝 | 后台审核拒绝 | 0 | 后台 |
| 3 | 已返款 | 已完成打款 | 1 | 后台 |

---

## 提现类型说明 (type)

| 类型值 | 类型名 | 业务含义 | 资金来源 |
|--------|--------|----------|----------|
| 1 | 余额提现 | 提取账户余额 | balance字段 |
| 2 | 银锭提现 | 提取银锭余额 | reward字段 |

---

## 关联表

- `users`: 买手用户表 (uid)
- `user_deposit_recharge`: 买手押金财务流水表

---

## 后台可修改字段

以下字段后台管理员有权限修改：

1. `state` - 审核状态 (0→1/2, 1→3)
2. `memo` - 备注/拒绝原因/打款单号
3. `examine_time` - 审核时间

---

## 金额计算规则

- `price` = 买手申请提现金额
- `poundage` = 手续费（根据系统配置计算）
- `toaccount` = price - poundage（实际到账金额）
- `yprice` = 申请时账户余额（用于记录快照）

---

## 业务规则

1. 买手可选择提现余额或银锭
2. 提现申请需填写完整银行信息
3. 后台拒绝时需填写拒绝原因，金额退回账户
4. 打款成功后需在 memo 中记录打款单号（如：微信转账单号）
5. 余额与银锭是两个独立的账户，分开提现
