# 任务详情页面全面审计报告

**审计日期**: 2026-01-13  
**审计范围**: 商户中心任务详情页、用户中心任务领取页、后台管理任务详情页  
**对比基准**: 任务发布时可设置的所有字段（TaskFormData接口）

---

## 一、审计概述

### 审计发现总结
经过全面对比任务发布表单（Step1BasicInfo + Step2ValueAdded）与三个任务详情页面，发现**大量关键信息在详情页中缺失或未完整显示**。

### 严重程度分级
- 🔴 **P0 - 严重缺失**: 核心业务字段完全未显示
- 🟡 **P1 - 重要缺失**: 重要配置信息未显示
- 🟢 **P2 - 次要缺失**: 辅助信息未显示

---

## 二、多商品列表功能缺失 🔴 P0

### 问题描述
任务发布支持**最多3个商品**（1个主商品 + 2个副商品），但所有详情页只显示单个商品信息。

### 发布时可设置的字段
```typescript
goodsList: GoodsItem[];  // 商品列表（最多3个）

interface GoodsItem {
    id: string;
    goodsId?: string;
    name: string;          // 商品名称
    image: string;         // 商品图片
    link: string;          // 商品链接
    price: number;         // 单价
    quantity: number;      // 数量
    keywords?: KeywordConfig[];      // 多关键词配置（最多10个）
    orderSpecs?: OrderSpecConfig[];  // 下单规格配置（最多5个）
    verifyCode?: string;   // 核对口令
    shopId?: string;
    filterSettings?: GoodsFilterSettings;  // 商品筛选设置
}
```

### 当前显示情况
| 页面 | 显示情况 | 缺失内容 |
|------|---------|---------|
| 商户任务详情页 | ❌ 只显示单个商品 | 副商品1、副商品2的所有信息 |
| 用户任务领取页 | ❌ 只显示单个商品 | 副商品1、副商品2的所有信息 |
| 后台任务详情页 | ❌ 只显示单个商品 | 副商品1、副商品2的所有信息 |

### 影响
- 买手无法看到需要购买的副商品信息
- 商户无法确认发布的多商品任务是否正确
- 后台管理员无法审核多商品任务的完整性

---

## 三、多关键词配置缺失 🔴 P0

### 问题描述
每个商品支持**最多10个关键词**，每个关键词可配置使用次数和独立的筛选设置，但详情页只显示单个关键词。

### 发布时可设置的字段
```typescript
keywords: KeywordConfig[];  // 每个商品最多10个关键词

interface KeywordConfig {
    keyword: string;                  // 搜索关键词
    useCount?: number;                // 使用次数
    advancedSettings?: KeywordAdvancedSettings;  // 高级设置
    filterSettings?: GoodsFilterSettings;        // 关键词级别筛选
}

interface KeywordAdvancedSettings {
    compareKeyword?: string;  // 货比关键词（可选，不填则用搜索关键词）
    backupKeyword?: string;   // 备用关键词（找不到商品时使用）
}
```

### 当前显示情况
| 页面 | 显示情况 | 缺失内容 |
|------|---------|---------|
| 商户任务详情页 | ❌ 只显示 `task.keyword` 单个字段 | 其余9个关键词、使用次数、高级设置 |
| 用户任务领取页 | ❌ 只显示 `task.keyword` 单个字段 | 其余9个关键词、使用次数、高级设置 |
| 后台任务详情页 | ❌ 只显示 `task.keyword` 单个字段 | 其余9个关键词、使用次数、高级设置 |

### 关键词高级设置缺失
- **货比关键词** (`compareKeyword`): 用于货比浏览的专用关键词
- **备用关键词** (`backupKeyword`): 搜索关键词找不到商品时的备选

---

## 四、关键词筛选设置缺失 🔴 P0

### 问题描述
支持**商品级别**和**关键词级别**的筛选设置，包括排序、价格范围、发货地等，但详情页完全未显示。

### 发布时可设置的字段
```typescript
interface GoodsFilterSettings {
    discount: string[];       // 折扣服务选项（多选）
    sort: string;             // 排序方式（综合/销量/价格升序/价格降序/信用）
    minPrice: number;         // 最低价
    maxPrice: number;         // 最高价
    province: string;         // 发货地（31个省份）
}

// 两个级别的筛选设置
goodsItem.filterSettings       // 商品级别（所有关键词共享）
keyword.filterSettings         // 关键词级别（每个关键词独立）
```

### 当前显示情况
| 页面 | 显示情况 |
|------|---------|
| 商户任务详情页 | ❌ 完全未显示 |
| 用户任务领取页 | ❌ 完全未显示 |
| 后台任务详情页 | ❌ 完全未显示 |

### 影响
- 买手不知道应该按什么条件筛选商品
- 可能导致买手找错商品或无法找到商品
- 影响任务执行的准确性

---

## 五、下单规格配置缺失 🔴 P0

### 问题描述
每个商品支持**最多5个下单规格**（如：颜色、尺码等），但详情页完全未显示。

### 发布时可设置的字段
```typescript
orderSpecs: OrderSpecConfig[];  // 每个商品最多5个规格

interface OrderSpecConfig {
    specName: string;     // 规格名称（如：颜色、尺码）
    specValue: string;    // 规格值（如：红色、XL）
    quantity: number;     // 购买数量
}
```

### 当前显示情况
| 页面 | 显示情况 | 缺失内容 |
|------|---------|---------|
| 商户任务详情页 | ❌ 未显示 | 所有规格配置 |
| 用户任务领取页 | ❌ 未显示 | 所有规格配置 |
| 后台任务详情页 | ❌ 未显示 | 所有规格配置 |

### 影响
- 买手不知道应该购买什么规格的商品
- 可能导致买手下单错误规格
- 严重影响任务执行准确性

---

## 六、核对口令缺失 🔴 P0

### 问题描述
每个商品可设置**核对口令**（最多10字，必须是商品详情页有的文字），用于买手核对是否找对商品，但详情页未显示。

### 发布时可设置的字段
```typescript
verifyCode?: string;  // 核对口令（最多10字，必须是商品详情页有的文字）
```

### 当前显示情况
| 页面 | 显示情况 |
|------|---------|
| 商户任务详情页 | ❌ 未显示 |
| 用户任务领取页 | ❌ 未显示 |
| 后台任务详情页 | ❌ 未显示 |

### 影响
- 买手无法核对是否找对商品
- 可能导致买手购买错误商品
- 失去了重要的商品验证机制

---

## 七、下单提示/商家备注显示不完整 🟡 P1

### 问题描述
`memo` 字段（最多100字）在部分页面显示，但显示位置和样式不统一。

### 发布时可设置的字段
```typescript
memo: string;  // 下单提示/备注（最多100字）
// 示例：商品在第*页*行、聊天时不要问发货地和哪家快递等
```

### 当前显示情况
| 页面 | 显示情况 |
|------|---------|
| 商户任务详情页 | ✅ 显示（独立卡片，琥珀色背景） |
| 用户任务领取页 | ✅ 显示（独立卡片，琥珀色背景） |
| 后台任务详情页 | ✅ 显示（独立卡片，琥珀色背景） |

### 建议
- 当前显示正常，保持现状

---

## 八、包裹重量缺失 🟡 P1

### 问题描述
`weight` 字段（0-30kg）用于计算物流费用，但详情页未显示。

### 发布时可设置的字段
```typescript
weight: number;  // 包裹重量（0-30kg，用于计算物流费用）
```

### 当前显示情况
| 页面 | 显示情况 |
|------|---------|
| 商户任务详情页 | ❌ 未显示 |
| 用户任务领取页 | ❌ 未显示 |
| 后台任务详情页 | ❌ 未显示 |

### 建议
- 在"物流设置"或"任务信息"区域显示包裹重量

---

## 九、快速返款服务显示不完整 🟡 P1

### 问题描述
`fastRefund` 字段（0.6%费率）在详情页未明确显示。

### 发布时可设置的字段
```typescript
fastRefund: boolean;  // 快速返款服务（0.6%费率）
// 说明：开启后，买手确认收货后系统自动快速返款，无需等待平台结算周期
```

### 当前显示情况
| 页面 | 显示情况 |
|------|---------|
| 商户任务详情页 | ⚠️ 未单独显示（可能包含在增值服务中） |
| 用户任务领取页 | ❌ 未显示 |
| 后台任务详情页 | ❌ 未显示 |

### 建议
- 在"增值服务"区域明确显示快速返款服务状态

---

## 十、任务接单间隔显示不完整 🟡 P1

### 问题描述
`orderInterval` 字段（分钟）用于控制买手接单的时间间隔，显示不统一。

### 发布时可设置的字段
```typescript
orderInterval: number;  // 任务接单间隔（分钟）
```

### 当前显示情况
| 页面 | 显示情况 | 字段名 |
|------|---------|--------|
| 商户任务详情页 | ⚠️ 显示但字段名不一致 | `task.unionInterval` |
| 用户任务领取页 | ❌ 未显示 | - |
| 后台任务详情页 | ⚠️ 显示但字段名不一致 | `detailModal.unionInterval` |

### 建议
- 统一使用 `orderInterval` 字段名
- 在用户任务领取页也显示接单间隔信息

---

## 十一、口令验证功能显示不完整 🟡 P1

### 问题描述
口令验证功能包含两个字段，但显示不完整。

### 发布时可设置的字段
```typescript
isPasswordEnabled: boolean;  // 是否开启口令验证
checkPassword: string;       // 商品口令（4-10字）
```

### 当前显示情况
| 页面 | `isPasswordEnabled` | `checkPassword` |
|------|---------------------|-----------------|
| 商户任务详情页 | ⚠️ 条件显示 | ✅ 显示 |
| 用户任务领取页 | ❌ 未显示 | ❌ 未显示 |
| 后台任务详情页 | ❌ 未显示 | ❌ 未显示 |

### 建议
- 在所有详情页明确显示口令验证状态
- 用户任务领取页应显示口令，方便买手核对

---

## 十二、浏览行为设置显示情况

### 发布时可设置的字段
```typescript
// 浏览行为
needCompare: boolean;       // 货比
compareCount: number;       // 货比数量（2/3/5家）
needFavorite: boolean;      // 收藏商品
needFollow: boolean;        // 关注店铺
needAddCart: boolean;       // 加入购物车
needContactCS: boolean;     // 联系客服
contactCSContent: string;   // 联系客服内容

// 浏览时长
totalBrowseMinutes: number;  // 总浏览时长（分钟）
mainBrowseMinutes: number;   // 主商品浏览时长
subBrowseMinutes: number;    // 副商品浏览时长
```

### 当前显示情况
| 页面 | 浏览行为 | 浏览时长 | 缺失内容 |
|------|---------|---------|---------|
| 商户任务详情页 | ✅ 显示 | ✅ 显示 | `compareCount`、`contactCSContent` |
| 用户任务领取页 | ✅ 显示 | ✅ 显示 | `compareCount`、`contactCSContent` |
| 后台任务详情页 | ✅ 显示 | ✅ 显示 | `compareCount`、`contactCSContent` |

### 建议
- 显示货比数量（2/3/5家）
- 显示联系客服的具体内容

---

## 十三、好评设置显示情况

### 发布时可设置的字段
```typescript
isPraise: boolean;
praiseType: 'text' | 'image' | 'video' | 'none';
praiseList: string[];        // 文字内容（每单一条）
praiseImgList: string[][];   // 图片（每单最多5张）
praiseVideoList: string[];   // 视频（每单一个）
```

### 当前显示情况
| 页面 | 显示情况 |
|------|---------|
| 商户任务详情页 | ✅ 显示完整（支持查看详情弹窗） |
| 用户任务领取页 | ⚠️ 显示类型，但内容预览不完整 |
| 后台任务详情页 | ✅ 显示完整（弹窗中展示所有内容） |

### 建议
- 用户任务领取页增加好评内容预览

---

## 十四、增值服务显示情况

### 发布时可设置的字段
```typescript
isTimingPublish: boolean;    // 定时发布
publishTime?: string;
isTimingPay: boolean;        // 定时付款
timingPayTime?: string;
isCycleTime: boolean;        // 延长买号周期
cycleTime?: number;          // 天数
addReward: number;           // 额外悬赏
isRepay: boolean;            // 回购任务
isNextDay: boolean;          // 隔天任务
fastRefund: boolean;         // 快速返款服务
orderInterval: number;       // 任务接单间隔
```

### 当前显示情况
| 页面 | 显示情况 | 缺失内容 |
|------|---------|---------|
| 商户任务详情页 | ✅ 大部分显示 | `fastRefund` 未明确标注 |
| 用户任务领取页 | ⚠️ 部分显示 | `fastRefund`、`orderInterval`、`isCycleTime` |
| 后台任务详情页 | ✅ 大部分显示 | `fastRefund` 未明确标注 |

---

## 十五、任务入口类型显示情况

### 发布时可设置的字段
```typescript
taskEntryType: number;  // 1=关键词, 2=淘口令, 3=二维码, 4=直通车, 5=通道

// 对应字段
keyword: string;         // 关键词
taoWord?: string;        // 淘口令
qrCodeImage?: string;    // 二维码
ztcKeyword?: string;     // 直通车关键词
channelUrl?: string;     // 通道链接
```

### 当前显示情况
| 页面 | 显示情况 |
|------|---------|
| 商户任务详情页 | ✅ 显示完整（自动判断类型） |
| 用户任务领取页 | ✅ 显示完整（自动判断类型） |
| 后台任务详情页 | ✅ 显示完整（自动判断类型） |

---

## 十六、修复优先级建议

### 🔴 P0 - 必须立即修复（严重影响业务）
1. **多商品列表显示** - 副商品信息完全缺失
2. **多关键词配置显示** - 只显示1个关键词，其余9个缺失
3. **关键词筛选设置显示** - 排序、价格、发货地等筛选条件缺失
4. **下单规格配置显示** - 规格信息完全缺失
5. **核对口令显示** - 商品验证机制缺失
6. **关键词高级设置显示** - 货比关键词、备用关键词缺失

### 🟡 P1 - 重要修复（影响用户体验）
7. 包裹重量显示
8. 快速返款服务明确标注
9. 任务接单间隔统一显示
10. 口令验证功能完整显示
11. 货比数量显示
12. 联系客服内容显示

### 🟢 P2 - 优化改进（提升完整性）
13. 用户任务领取页好评内容预览
14. 增值服务显示优化

---

## 十七、数据结构问题

### 问题1: 字段名不一致
- 发布时使用 `orderInterval`
- 详情页使用 `unionInterval`
- **建议**: 统一使用 `orderInterval`

### 问题2: 多商品数据未存储
- 发布时支持 `goodsList` 数组
- 详情页只有单商品字段（`title`, `mainImage`, `url`, `keyword`等）
- **建议**: 检查后端是否正确存储了 `goodsList` 数据

### 问题3: 多关键词数据未存储
- 发布时支持 `keywords` 数组（每个商品最多10个）
- 详情页只有单个 `keyword` 字段
- **建议**: 检查后端是否正确存储了 `keywords` 数据

---

## 十八、修复建议

### 1. 后端数据存储检查
首先确认后端是否正确存储了以下数据：
- `goodsList` 数组（多商品）
- `keywords` 数组（多关键词）
- `orderSpecs` 数组（下单规格）
- `filterSettings` 对象（筛选设置）
- `verifyCode` 字段（核对口令）

### 2. 前端显示改造
如果后端数据完整，需要改造三个详情页：

#### 商户任务详情页 (`frontend/src/app/merchant/tasks/[id]/page.tsx`)
- 添加多商品列表展示区域
- 添加多关键词配置展示
- 添加下单规格展示
- 添加筛选设置展示
- 添加核对口令展示

#### 用户任务领取页 (`frontend/src/app/tasks/[id]/page.tsx`)
- 添加多商品列表展示（重点显示主商品）
- 添加关键词列表展示
- 添加下单规格展示（买手必看）
- 添加筛选条件展示
- 添加核对口令展示

#### 后台任务详情页 (`frontend/src/app/admin/tasks/page.tsx`)
- 在弹窗中添加多商品列表
- 添加多关键词配置
- 添加下单规格
- 添加筛选设置
- 添加核对口令

### 3. UI设计建议
- 多商品：使用卡片列表，主商品标记为"主"，副商品标记为"副1"、"副2"
- 多关键词：使用标签列表或表格展示，显示关键词、使用次数、筛选设置
- 下单规格：使用表格展示规格名、规格值、数量
- 筛选设置：使用标签或列表展示排序方式、价格范围、发货地
- 核对口令：使用醒目的标签或高亮文本显示

---

## 十九、总结

### 核心问题
1. **多商品功能完全缺失** - 这是最严重的问题，副商品信息完全不显示
2. **多关键词功能完全缺失** - 只显示1个关键词，其余9个不显示
3. **关键词筛选设置完全缺失** - 买手不知道如何筛选商品
4. **下单规格配置完全缺失** - 买手不知道购买什么规格
5. **核对口令完全缺失** - 失去了商品验证机制

### 影响评估
- **对商户**: 无法确认发布的任务是否正确，尤其是多商品任务
- **对买手**: 缺少关键执行信息，可能导致下单错误
- **对平台**: 任务执行准确性下降，可能增加纠纷和退款

### 修复工作量估算
- **后端检查**: 0.5天（确认数据是否正确存储）
- **前端改造**: 3-5天（三个详情页的UI改造和数据展示）
- **测试验证**: 1-2天（功能测试和数据验证）
- **总计**: 约5-8天

---

**审计人**: Kiro AI Assistant  
**审计完成时间**: 2026-01-13
