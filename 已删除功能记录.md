# 已删除功能记录

本文档记录了系统简化过程中删除的功能，以便将来需要时参考恢复。

---

## 1. VIP会员系统

### 删除内容
- **用户VIP状态字段**: `vip: boolean`, `vipExpireAt: Date`
- **VIP相关配置项**:
  - `user_register_vip_days` - 买手注册赠送VIP天数
  - `seller_register_vip_days` - 商家注册赠送VIP天数
  - `first_account_vip_days` - 首个买号审核通过赠送VIP天数
- **VIP过期检查逻辑**: `lastVipCheckAt` 字段用于避免每天重复降级
- **VIP筛选功能**: 用户列表中的VIP状态筛选

### 相关文件
- `backend/src/users/user.entity.ts` - 删除vip相关字段
- `backend/src/migrations/1768664195023-RemoveVipConfigs.ts` - 删除VIP配置的迁移

---

## 2. 买号收货地址相关

### 删除内容
- **常用登录地**: `loginLocation` / `loginCity` 字段
- **收货地址**: `address` 字段
- **收货人姓名**: 买号中的收货人信息（与实名姓名分离的部分）
- **平台配置中的地址选项**:
  - `hasLoginLocation: true` → 改为 `false`
  - `hasAddress: true` → 改为 `false`

### 简化后的买号字段
买号现在只保留以下核心字段：
- `platform` - 平台
- `platformAccount` - 平台账号
- `realName` - 实名姓名
- 资质截图（profileImg, creditImg, payAuthImg, scoreImg等）

### 地区信息迁移
- 用户所在地区（省/市/区县）已从买号移至用户注册时填写
- 用户表新增字段: `province`, `city`, `district`

### 相关文件
- `frontend/src/constants/platformConfig.ts` - 平台配置
- `frontend/src/app/admin/users/accounts/page.tsx` - 买号管理页面
- `backend/src/buyer-accounts/buyer-account.entity.ts` - 买号实体

---

## 3. 银锭扣除机制

### 删除内容

#### 3.1 接单扣除银锭
- **原逻辑**: 用户接单时需要扣除一定银锭作为保证金
- **扣除金额**: 根据任务类型和配置决定
- **相关财务流水**: `FundRecord` 中接单扣除银锭的记录

#### 3.2 每日前2单不扣银锭
- **原逻辑**: 每天前2单免扣银锭，从第3单开始扣除
- **计数重置**: 每日0点重置计数
- **相关字段**: 用户的每日接单计数

#### 3.3 23点-9点放弃任务解冻银锭
- **原逻辑**: 在23:00-09:00时段放弃任务，冻结的银锭会自动解冻返还
- **白天时段**: 09:00-23:00放弃任务不返还银锭
- **夜间豁免**: 考虑到用户可能因睡眠等原因无法完成任务

#### 3.4 系统返还银锭
- **原逻辑**: 特定条件下系统自动返还已扣除的银锭
- **返还场景**:
  - 商家取消任务
  - 任务超时自动取消
  - 系统异常导致任务失败

### 相关文件
- `backend/src/tasks/tasks.service.ts` - 任务服务中的银锭扣除逻辑
- `backend/src/users/fund-record.entity.ts` - 资金流水记录
- 相关配置项和常量

---

## 4. 用户名(username)字段

### 删除内容
- **用户表**: `username` 字段（用户手动输入的名字）
- **商家表**: `username` 字段（商家手动输入的名字）
- **注册表单**: 用户名输入框
- **登录支持**: 原支持用户名登录，现只支持手机号和用户ID(userNo)登录

### 保留的标识符
- **用户ID(userNo)**: U10001格式，系统自动生成，不可修改
- **商家ID(merchantNo)**: M10001格式，系统自动生成，不可修改
- **手机号(phone)**: 可用于登录，可修改

### 简化后的登录方式
- 手机号 + 密码
- 用户ID(如U10001) + 密码

### 相关文件
- `backend/src/users/user.entity.ts` - 用户实体
- `backend/src/merchants/merchant.entity.ts` - 商家实体
- `backend/src/auth/auth.service.ts` - 认证服务
- `frontend/src/app/register/page.tsx` - 注册页面
- `frontend/src/app/login/page.tsx` - 登录页面

---

## 5. 取消订单免罚豁免

### 删除内容

#### 5.1 每日前2单取消免罚
- **原逻辑**: 每天前2次取消订单不扣除银锭/罚款
- **计数方式**: 每日0点重置

#### 5.2 夜间取消免罚（23:00-09:00）
- **原逻辑**: 在夜间时段取消订单不扣除银锭
- **适用时间**: 23:00 - 次日09:00

### 相关文件
- `backend/src/tasks/tasks.service.ts` - 任务取消逻辑

---

## 6. 短信验证（买号绑定）

### 删除内容
- **平台配置**: `hasSmsVerification: true` → 改为 `false`
- **短信验证流程**: 绑定买号时的手机验证码验证

### 说明
- 所有平台的买号绑定现在都不需要短信验证
- 平台配置中 `hasSmsVerification` 统一设为 `false`

### 相关文件
- `frontend/src/constants/platformConfig.ts` - 平台配置

---

## 恢复指南

如需恢复以上任何功能，请参考以下步骤：

1. **查看Git历史**: 使用 `git log` 和 `git show` 查看删除前的代码
2. **数据库迁移**: 需要创建新的迁移文件添加回删除的字段
3. **前端页面**: 恢复相关表单字段和显示逻辑
4. **后端服务**: 恢复相关业务逻辑
5. **配置项**: 恢复系统配置表中的相关配置

---

## 更新记录

| 日期 | 删除功能 | 操作人 |
|------|----------|--------|
| 2026-01-18 | VIP会员系统 | Claude |
| 2026-01-18 | 买号收货地址 | Claude |
| 2026-01-18 | 银锭扣除机制 | Claude |
| 2026-01-18 | 用户名字段 | Claude |
| 2026-01-18 | 取消订单免罚豁免 | Claude |
| 2026-01-18 | 短信验证 | Claude |
